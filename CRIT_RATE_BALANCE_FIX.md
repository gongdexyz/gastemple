# 暴击率平衡调整 & 金币飞行目标优化

## 修改内容

### 1. 暴击率平衡调整

#### 问题
- 暴击概率太高，导致游戏失去挑战性
- 代敲时暴击率没有降低，产出过高

#### 解决方案

**新手保护（前 10 次点击）**：
- 基础暴击率：10%
- 第 3 次和第 7 次：100% 强制暴击
- 今日首次加成：翻倍
- 最高暴击率：35%

**老玩家（10 次点击后）**：
- 基础暴击率：5%（降低 50%）
- 连击加成：0.5%/次（降低）
- 保底加成：0.5%/次（降低）
- 最高暴击率：20%（降低）
- 保底触发：15 次未暴击（提高门槛）

**自动挂机惩罚**：
- 暴击率减半（×0.5）
- 防止挂机产出过高

#### 对比表

| 类型 | 基础暴击率 | 最高暴击率 | 保底次数 | 挂机惩罚 |
|------|-----------|-----------|---------|---------|
| 新手（前10次） | 10% | 35% | 12次 | 无 |
| 老玩家（手动） | 5% | 20% | 15次 | 无 |
| 老玩家（挂机） | 2.5% | 10% | 15次 | ×0.5 |

### 2. 金币飞行目标优化

#### 问题
- 金币飞向固定位置（x: 200, y: 300）
- 手机界面上看不清飞向哪里
- 没有飞向顶部钱袋子的视觉反馈

#### 解决方案

**动态目标定位**：
- 给顶部钱袋子添加 ID：`gd-balance-indicator`
- 动态获取钱袋子的屏幕位置
- 金币飞向钱袋子中心点

**实现逻辑**：
```typescript
const getTargetPosition = () => {
  const balanceIndicator = document.getElementById('gd-balance-indicator')
  if (balanceIndicator) {
    const rect = balanceIndicator.getBoundingClientRect()
    return {
      x: rect.left + rect.width / 2,
      y: rect.top + rect.height / 2
    }
  }
  // 默认位置（如果找不到钱袋子）
  return { x: 200, y: 300 }
}
```

**效果**：
- ✅ 手机界面：金币飞向顶部钱袋子
- ✅ 桌面界面：金币飞向顶部钱袋子
- ✅ 视觉反馈清晰，用户知道钱去哪了

## 修改的文件

1. `src/components/WoodenFish.tsx` - 暴击率逻辑调整
2. `src/stores/effectsStore.ts` - 金币飞行目标动态获取
3. `src/components/Header.tsx` - 钱袋子添加 ID

## 预期效果

### 暴击率
- **新手体验**：前 10 次点击必爆 2 次，立即上瘾
- **老玩家平衡**：5% 基础暴击率，保持挑战性
- **挂机平衡**：暴击率减半，防止产出过高

### 金币飞行
- **视觉反馈**：清晰看到金币飞向钱袋子
- **跨设备适配**：手机和桌面都能正确显示
- **用户体验**：知道钱去哪了，增加信任感

## 测试建议

### 暴击率测试
1. 清除 localStorage，模拟新用户
2. 点击 10 次，验证第 3 次和第 7 次是否暴击
3. 继续点击 20 次，统计暴击次数（应该约 1-2 次）
4. 开启自动挂机，观察暴击频率（应该更低）

### 金币飞行测试
1. 手机界面：点击木鱼，观察金币是否飞向顶部钱袋子
2. 桌面界面：点击木鱼，观察金币是否飞向顶部钱袋子
3. 暴击时：5 个金币同时飞向钱袋子
4. 滚动页面：金币仍然飞向正确位置（动态计算）

## 数据预测

### 暴击率分布（100 次点击）
- **新手（前 10 次）**：
  - 强制暴击：2 次
  - 随机暴击：约 1 次
  - 总计：约 3 次（30%）

- **老玩家（手动）**：
  - 基础暴击：约 5 次
  - 保底暴击：约 1 次
  - 总计：约 6 次（6%）

- **老玩家（挂机）**：
  - 基础暴击：约 2.5 次
  - 保底暴击：约 0.5 次
  - 总计：约 3 次（3%）

### 产出平衡
- **新手**：高产出，快速上手
- **老玩家手动**：中等产出，保持挑战
- **老玩家挂机**：低产出，防止通胀
